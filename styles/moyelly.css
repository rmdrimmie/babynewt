(function(){

/* http://www.quirksmode.org/js/findpos.html */
function findPos(obj) {
    var curleft = curtop = 0;
    if (!obj.offsetParent) return;
    do {
        curleft += obj.offsetLeft;
        curtop += obj.offsetTop;
    } while (obj = obj.offsetParent);
    return [curleft,curtop];
}

/* 
   Learn DOM Manipulation from the book my friend co-wrote that I'm 
   tech reviewing!

   DOM Scripting: Web Design with JavaScript and the Document Object Model
   http://friendsofed.com/book.html?isbn=9781430233893
*/
function moustachify() {
    var allImages = document.getElementsByTagName( 'img' ),
        thisBody = document.getElementsByTagName( 'body' )[0],
        moBase = 'http://miscellanean.com/webapps/movember/images/',
        moExt = '.png',
        moNames = [ 'chaplin', 'dali', 'django', 'fumanchu', 'handlebar'
            , 'hogan', 'hungarian', 'khan', 'magnum', 'pencil', 'poirot'
            , 'porn', 'regular', 'walrus', 'zappa'
        ],
        randomMoIndex, 
        newMo, 
        thisPosition,
        skellyflag,
        droboflag;
    
    for( var imgIndex = 0; imgIndex < allImages.length; imgIndex++ ) {
        if( allImages[imgIndex].className === 'yelly' && -1 !== allImages[imgIndex].src.indexOf( 'yelling.php' ) ) {
            randomMoIndex = Math.floor( Math.random() * (moNames.length) );
            newMo = document.createElement( 'img' );
            thisBody.appendChild( newMo );
            thisPosition = findPos( allImages[imgIndex] );
            newMo.setAttribute( 'src', moBase + moNames[randomMoIndex] + moExt );
            newMo.style.position = 'absolute';
            
            skellyflag = allImages[imgIndex].src.indexOf( 'skot=1' );
            droboflag = allImages[imgIndex].src.indexOf( '&drobo' );

            // skelly
            // yelling-yelling.php?skot=1&amp;text=
            if( -1 !== skellyflag ) {
                newMo.style.top = (thisPosition[1] + 80) + 'px'; 
                newMo.style.left = thisPosition[0] + 114 + 'px';
                newMo.style.width = 55 + 'px';
            }
            // drobo
            // yelling-yelling.php?drobo=1&amp;text=
            if( -1 !== droboflag ) {
                newMo.style.top = (thisPosition[1] + 80) + 'px'; 
                newMo.style.left = thisPosition[0] + 104 + 'px';
                newMo.style.width = 80 + 'px';
            }
            // yelly
            // yelling-yelling.php?text=
            if( -1 === skellyflag && -1 === droboflag ) {
                newMo.style.top = (thisPosition[1] + 50) + 'px'; 
                newMo.style.left = thisPosition[0] + 94 + 'px';
                newMo.style.width = 50 + 'px';
            }

        }
    }
}

if( document.addEventListener ) {
    //document.addEventListener( 'DOMContentLoaded', moustachify, false );
    window.addEventListener( 'load', moustachify, false );
} else if ( document.attachEvent ) {
    //document.attachEvent( 'onreadystatechange', moustachify );
    window.attachEvent( 'onload', moustachify );
}

})();